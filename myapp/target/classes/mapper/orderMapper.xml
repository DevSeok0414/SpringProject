<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order">

	<select id="orderList" resultType="com.devseok0414.myapp.model.dto.CartListDTO">
		SELECT 
				c.no, c.member_id, c.product_no, c.product_amount,
				p.name, p.price, p.product_image, c.product_amount*p.price AS total_price
		FROM cart c
		INNER JOIN product p
		ON c.product_no = p.no
		where c.member_id = #{memberId} and c.no = #{no} 
	</select>
	
	<select id="memberList" resultType="com.devseok0414.myapp.model.dto.MemberDTO">
		SELECT	id, name, phone FROM member WHERE id = #{id}
	</select>
	
	<select id="addressList" resultType="com.devseok0414.myapp.model.dto.AddressDTO">
		SELECT address1, address2, address3, address4, address5
		FROM address
		WHERE member_id = #{id}
	</select>

	<insert id="saveOrder" parameterType="com.devseok0414.myapp.model.dto.OrderDTO">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			SELECT seq_member_order.nextval FROM dual
		</selectKey>
		
		INSERT INTO member_order (no, member_id, total_price, status, reg_date, receiver_name, receiver_phone, receiver_address)
		VALUES (#{no}, #{memberId}, #{totalPrice}, default, default, #{receiverName}, #{receiverPhone}, #{receiverAddress})
	</insert>
	
	<select id="cartList" resultType="com.devseok0414.myapp.model.dto.CartDTO">
		SELECT product_no, product_amount
		FROM cart
		WHERE no = #{cartListNo}
	</select>
	
	<select id="productPrice" resultType="_int">
		SELECT price FROM product WHERE no = #{productNo}
	</select>
	
	<insert id="saveOrderDetail">
		INSERT INTO order_detail (no, order_no, product_no, product_amount, product_price)
		VALUES (seq_order_detail.nextval, #{orderNo}, #{productNo}, #{productAmount}, #{productPrice})
	</insert>
	
	<delete id="removeAllCart">
		DELETE FROM cart
		WHERE member_id = #{memberId}
	</delete>
	
</mapper>