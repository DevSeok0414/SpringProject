<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

	<insert id="signup">
		INSERT INTO member (id, password, name, phone, email, reg_date, auth) 
			VALUES (#{id}, #{password}, #{name}, #{phone}, #{email}, default, default)
	</insert>
	
	<insert id="addressSave">
		INSERT INTO address (no, member_id, address1, address2, address3, address4, address5) 
			VALUES (seq_address.nextval, #{memberId}, #{address1}, #{address2}, #{address3}, #{address4}, #{address5})
	</insert>
	
	<select id="login" resultType="com.devseok0414.myapp.model.dto.MemberDTO">
		SELECT * FROM member WHERE id = #{id}
	</select>
	
	<select id="selectAddress" resultType="com.devseok0414.myapp.model.dto.AddressDTO">
		SELECT * FROM address WHERE member_id = #{memberId}
	</select>
	
	<update id="modifyMember">
		UPDATE member SET password = #{password}, phone = #{phone}, email = #{email}
		WHERE id = #{id}
	</update>
	
	<update id="modifyAddress">
		UPDATE address SET address1 = #{address1}, address2 = #{address2}, address3 = #{address3}, address4 = #{address4}, address5 = #{address5}
		WHERE member_id = #{memberId}
	</update>
	
	<select id="listCriteria" resultType="com.devseok0414.myapp.model.dto.OrderDTO">
		SELECT * FROM member_order WHERE member_id = #{memberId} ORDER BY no DESC
	</select>
	
	<select id="listCountCriteria" resultType="_int">
		SELECT count(*) FROM member_order WHERE member_id = #{memberId}
	</select>
	
	<select id="searchListCriteria" resultType="com.devseok0414.myapp.model.dto.OrderDTO">
		SELECT * FROM member_order WHERE ${searchSelect} Like '%'||#{searchText}||'%' AND member_id = #{memberId} ORDER BY no DESC
	</select>
	
	<select id="searchListCountCriteria" resultType="_int">
		SELECT count(*) FROM member_order WHERE ${searchSelect} Like '%'||#{searchText}||'%' AND member_id = #{memberId}
	</select>
	
	<select id="selectOrder" resultType="com.devseok0414.myapp.model.dto.OrderDTO">
		SELECT * FROM member_order WHERE no = #{no}
	</select>
	
	<select id="selectOrderDetailList" resultType="com.devseok0414.myapp.model.dto.OrderDetailDTO">
		SELECT * FROM order_detail WHERE order_no = #{no}
	</select>
	
	<select id="selectProductName" resultType="string">
		SELECT name FROM product WHERE no = #{productNo}
	</select>
	
</mapper>